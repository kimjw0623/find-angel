# find-angel 프로젝트 가이드

## 프로젝트 개요

이 프로젝트는 **로스트아크 경매장 시장 분석 및 모니터링 시스템**입니다. 경매장의 고급 악세서리(목걸이, 귀걸이, 반지)와 팔찌의 가격을 자동으로 수집하고 분석하여, 수익성이 높은 매물을 찾아 디스코드로 알림을 보내는 시스템입니다.

## 주요 기능

### 1. 데이터 수집 및 분석
- **가격 수집**: 30분마다 경매장 데이터 수집 (`async_price_collector.py`)
- **실시간 모니터링**: 새로 올라온 매물 실시간 스캔 (`async_item_checker.py`)
- **가격 평가**: 캐시된 가격 데이터 기반 아이템 평가 (`item_evaluator.py`)
- **디스코드 알림**: 수익성 높은 매물 자동 알림 (`discord_manager.py`)

### 2. 웹 인터페이스
- **백엔드 API**: FastAPI 기반 REST API (`backend.py`)
- **프론트엔드**: React 기반 시각화 대시보드 (`frontend/`)
  - 악세서리 가격 추이 차트
  - 팔찌 가격 분석
  - 연마 시뮬레이터

### 3. 데이터베이스 구조
- **메인 DB**: 원시 가격 기록 저장 (`database.py`)
- **캐시 DB**: 가공된 가격 패턴 저장 (`cache_database.py`)

## 기술 스택

### Backend
- **Python 3.x**: 메인 언어
- **FastAPI**: 웹 API 프레임워크
- **aiohttp**: 비동기 HTTP 클라이언트
- **SQLite**: 데이터베이스 (WAL 모드)
- **asyncio**: 비동기 프로그래밍

### Frontend
- **React 18**: UI 라이브러리
- **Tailwind CSS**: 스타일링
- **Chakra UI**: 컴포넌트 라이브러리
- **Recharts**: 차트 라이브러리
- **axios**: HTTP 클라이언트

## 실행 방법

### 환경 설정
1. `.env` 파일 생성 및 API 토큰 설정:
   ```
   PRICE_TOKEN_1=your_token_here
   PRICE_TOKEN_2=your_token_here
   MONITOR_TOKEN_1=your_token_here
   MONITOR_TOKEN_2=your_token_here
   ```

### 백엔드 실행
```bash
# 가격 수집기 실행
python async_price_collector.py

# 실시간 모니터링 실행
python async_item_checker.py

# 웹 API 서버 실행
python backend.py
```

### 프론트엔드 실행
```bash
cd frontend
npm install
npm start
```

## 주요 커밋 히스토리 분석

### 최근 개발 동향
- **비동기 처리 도입**: `asyncio`, `aiohttp` 사용으로 성능 향상
- **프론트엔드 개발**: React 기반 시각화 대시보드 구현
- **데이터베이스 최적화**: 캐시 DB 분리, 검색 성능 개선
- **디스코드 통합**: 매물 추적 및 알림 시스템 구현

### 주요 개선사항
- JS에서 JSX로 변경으로 코드 가독성 향상
- 디스코드 에러 처리 개선
- 가격 비율 조정 알고리즘 개선 (0.5~0.75 범위)
- 팔찌 시각화 기능 추가

## 개발 패턴 및 컨벤션

### 코드 구조
- **모듈화**: 기능별 파일 분리
- **비동기 처리**: `async/await` 패턴 사용
- **에러 처리**: 안정적인 예외 처리
- **로깅**: 상세한 로그 기록

### 데이터 처리
- **캐싱**: 성능 최적화를 위한 다단계 캐싱
- **배치 처리**: API 호출 효율성 향상
- **동시성**: 안전한 멀티스레딩

### 프론트엔드 구조
- **컴포넌트 분리**: 재사용 가능한 컴포넌트 구조
- **페이지 기반 라우팅**: 기능별 대시보드 분리
- **반응형 디자인**: Tailwind CSS 활용

## 개발 시 주의사항

### API 사용
- 로스트아크 공식 API 사용량 제한 준수
- 토큰 로테이션으로 효율적인 API 호출
- 에러 발생 시 적절한 백오프 전략 적용

### 데이터베이스
- SQLite WAL 모드 사용으로 동시성 보장
- 인덱스 최적화로 쿼리 성능 향상
- 정기적인 데이터 정리 필요

### 디스코드 통합
- 웹훅 URL 보안 관리
- 메시지 포맷 일관성 유지
- 스팸 방지를 위한 알림 주기 조절

### 설정 관리
- **config.py**: 모든 설정값은 config 객체를 통해 접근
- **하드코딩 금지**: 직접 숫자나 문자열 하드코딩 대신 설정값 사용
- **환경 변수**: 민감한 정보는 `.env` 파일로 관리
- **설정 분류**: 기능별로 논리적으로 그룹화된 설정 구조 유지

## 실행 명령어

### 개발 환경
```bash
# 백엔드 개발 서버 실행
python backend.py

# 프론트엔드 개발 서버 실행
cd frontend && npm start

# 테스트 실행
python -m pytest
```

### 배포 환경
```bash
# 프론트엔드 빌드
cd frontend && npm run build

# 백엔드 프로덕션 실행
python backend.py --host 0.0.0.0 --port 8000
```

## 최근 리팩토링 작업 (2025-07-04)

### 코드 정리 및 구조 개선
- **old 폴더 정리**: 더 이상 사용하지 않는 동기 버전 코드들 제거
- **토큰 관리 통합**: `utils.py`의 사용하지 않는 `TokenManager` 클래스 제거
- **import 경로 수정**: `item_test.py`에서 `item_checker` → `item_evaluator`로 변경

### 데이터베이스 아키텍처 리팩토링
- **BaseDatabaseManager 도입**: 공통 데이터베이스 로직 추상화
- **중복 코드 제거**: ~115줄의 중복된 세션 관리 코드 제거
- **확장성 개선**: 새로운 데이터베이스 추가 시 간편한 확장 구조

### 설정 관리 시스템 구축
- **통합 Config 클래스**: 모든 설정값을 중앙 관리
- **환경 변수 자동 로드**: 토큰, 웹훅 URL 등 자동 매핑
- **하드코딩 제거**: 마법 숫자들을 의미 있는 설정값으로 대체
- **타입 안정성**: 설정값 접근 패턴 일관성 확보

### 새로 추가된 파일
- `base_database.py`: 데이터베이스 매니저의 공통 기능 제공

### 개선된 파일들
- `database.py`: DatabaseManager 간소화 (60줄 → 6줄)
- `cache_database.py`: CacheDBManager 간소화 (55줄 → 6줄)
- `utils.py`: 불필요한 import 및 클래스 제거
- `config.py`: 통합 설정 관리 시스템 구축

## 향후 개발 계획

### 단기 목표
- 딜증 계산 기능 추가
- 수동 검색 기능 구현
- 대형 메서드 분해 (collect_prices, update_cache 등)

### 중기 목표
- 데이터베이스 용량 최적화
- 시각화 기능 확장
- 모바일 반응형 개선
- 타입 힌트 추가

### 장기 목표
- 머신러닝 기반 가격 예측
- 실시간 알림 시스템 고도화
- 사용자 맞춤형 필터링 기능